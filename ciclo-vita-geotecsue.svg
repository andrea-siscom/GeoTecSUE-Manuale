<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 1100" width="900" height="1100">
  <defs>
    <style>
      .state-box {
        stroke: #333;
        stroke-width: 2;
        rx: 8;
      }
      .state-prof { fill: #e1f5ff; }
      .state-ente { fill: #fff4e1; }
      .state-final-ok { fill: #e8f5e9; }
      .state-final-ko { fill: #ffebee; }
      .state-text {
        font-family: Arial, sans-serif;
        font-size: 14px;
        font-weight: bold;
        text-anchor: middle;
        fill: #333;
      }
      .state-text-small {
        font-family: Arial, sans-serif;
        font-size: 11px;
        text-anchor: middle;
        fill: #666;
      }
      .arrow {
        stroke: #555;
        stroke-width: 2;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .arrow-special {
        stroke: #f57c00;
        stroke-width: 2;
        stroke-dasharray: 5,5;
        fill: none;
        marker-end: url(#arrowhead-special);
      }
      .decision {
        fill: #fff9c4;
        stroke: #f57c00;
        stroke-width: 2;
      }
      .legend-text {
        font-family: Arial, sans-serif;
        font-size: 12px;
        fill: #333;
      }
      .title-text {
        font-family: Arial, sans-serif;
        font-size: 20px;
        font-weight: bold;
        text-anchor: middle;
        fill: #333;
      }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#555" />
    </marker>
    <marker id="arrowhead-special" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f57c00" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" class="title-text">Ciclo di vita di un'istanza GeoTecSUE</text>
  
  <!-- Stati Professionista -->
  <rect x="50" y="70" width="180" height="60" class="state-box state-prof"/>
  <text x="140" y="95" class="state-text">In Compilazione</text>
  <text x="140" y="115" class="state-text-small">Salvata ma incompleta</text>
  
  <rect x="50" y="170" width="180" height="60" class="state-box state-prof"/>
  <text x="140" y="195" class="state-text">Completata</text>
  <text x="140" y="215" class="state-text-small">Validata con successo</text>
  
  <rect x="50" y="270" width="180" height="60" class="state-box state-prof"/>
  <text x="140" y="295" class="state-text">Firmata</text>
  <text x="140" y="315" class="state-text-small">PDF firmato caricato</text>
  
  <!-- Stati Ente - Flusso principale -->
  <rect x="360" y="70" width="180" height="60" class="state-box state-ente"/>
  <text x="450" y="95" class="state-text">Inviata</text>
  <text x="450" y="115" class="state-text-small">Trasmessa all'Ente</text>
  
  <rect x="360" y="170" width="180" height="60" class="state-box state-ente"/>
  <text x="450" y="195" class="state-text">Protocollata</text>
  <text x="450" y="215" class="state-text-small">N° protocollo assegnato</text>
  
  <rect x="360" y="270" width="180" height="60" class="state-box state-ente"/>
  <text x="450" y="295" class="state-text">Registrata</text>
  <text x="450" y="315" class="state-text-small">Presa in carico</text>
  
  <!-- Decision point -->
  <polygon points="450,390 530,430 450,470 370,430" class="decision"/>
  <text x="450" y="425" class="state-text" style="font-size: 12px;">Richiesta</text>
  <text x="450" y="440" class="state-text" style="font-size: 12px;">integrazioni?</text>
  
  <!-- Stati Integrazione -->
  <rect x="50" y="400" width="180" height="60" class="state-box state-ente"/>
  <text x="140" y="425" class="state-text">Richiesta Integrazioni</text>
  <text x="140" y="445" class="state-text-small">Documenti richiesti</text>
  
  <rect x="50" y="500" width="180" height="60" class="state-box state-ente"/>
  <text x="140" y="525" class="state-text">Invio Integrazioni</text>
  <text x="140" y="545" class="state-text-small">Documenti trasmessi</text>
  
  <!-- Decision Esito -->
  <polygon points="450,570 530,610 450,650 370,610" class="decision"/>
  <text x="450" y="605" class="state-text" style="font-size: 12px;">Esito</text>
  <text x="450" y="620" class="state-text" style="font-size: 12px;">istruttoria</text>
  
  <!-- Stati Finali -->
  <rect x="360" y="710" width="180" height="60" class="state-box state-final-ok"/>
  <text x="450" y="735" class="state-text">Esecutiva</text>
  <text x="450" y="755" class="state-text-small">Provvedimento rilasciato</text>
  
  <rect x="610" y="710" width="180" height="60" class="state-box state-final-ko"/>
  <text x="700" y="735" class="state-text">Diniego</text>
  <text x="700" y="755" class="state-text-small">Parere negativo</text>
  
  <rect x="110" y="710" width="180" height="60" class="state-box state-final-ko"/>
  <text x="200" y="735" class="state-text">Archiviata</text>
  <text x="200" y="755" class="state-text-small">Pratica archiviata</text>
  
  <!-- Arrows - Flusso principale professionista -->
  <line x1="140" y1="130" x2="140" y2="170" class="arrow"/>
  <line x1="140" y1="230" x2="140" y2="270" class="arrow"/>
  <line x1="230" y1="300" x2="360" y2="100" class="arrow"/>
  
  <!-- Arrows - Flusso principale ente -->
  <line x1="450" y1="130" x2="450" y2="170" class="arrow"/>
  <line x1="450" y1="230" x2="450" y2="270" class="arrow"/>
  <line x1="450" y1="330" x2="450" y2="390" class="arrow"/>
  
  <!-- Arrows - Decision integrazioni -->
  <line x1="370" y1="430" x2="230" y2="430" class="arrow"/>
  <text x="300" y="420" class="state-text-small" style="fill: #f57c00;">SÌ</text>
  
  <line x1="140" y1="460" x2="140" y2="500" class="arrow"/>
  
  <!-- Arrow loop integrazione -->
  <path d="M 50 530 L 20 530 L 20 300 L 360 300" class="arrow-special"/>
  <text x="25" y="420" class="state-text-small" style="fill: #f57c00; text-anchor: start;">Ritorna in</text>
  <text x="25" y="435" class="state-text-small" style="fill: #f57c00; text-anchor: start;">istruttoria</text>
  
  <!-- Arrow to esito decision -->
  <line x1="450" y1="470" x2="450" y2="570" class="arrow"/>
  <text x="470" y="520" class="state-text-small" style="fill: #666;">NO</text>
  
  <!-- Arrows - Esiti finali -->
  <line x1="450" y1="650" x2="450" y2="710" class="arrow"/>
  <text x="470" y="685" class="state-text-small" style="fill: #4caf50;">POSITIVO</text>
  
  <line x1="530" y1="610" x2="700" y2="710" class="arrow"/>
  <text x="620" y="665" class="state-text-small" style="fill: #d32f2f;">NEGATIVO</text>
  
  <line x1="370" y1="610" x2="200" y2="710" class="arrow"/>
  <text x="270" y="665" class="state-text-small" style="fill: #d32f2f;">ARCHIVIAZIONE</text>
  
  <!-- Revoca Delegato -->
  <rect x="610" y="810" width="180" height="60" class="state-box state-final-ko"/>
  <text x="700" y="835" class="state-text">Revoca Delegato</text>
  <text x="700" y="855" class="state-text-small">Incarico revocato</text>
  
  <line x1="700" y1="770" x2="700" y2="810" class="arrow" style="stroke-dasharray: 3,3;"/>
  <text x="720" y="795" class="state-text-small" style="fill: #666;">(da qualsiasi stato)</text>
  
  <!-- Legend -->
  <g transform="translate(50, 920)">
    <text x="0" y="0" class="legend-text" style="font-weight: bold; font-size: 14px;">Legenda:</text>
    
    <rect x="0" y="15" width="80" height="30" class="state-box state-prof"/>
    <text x="90" y="35" class="legend-text">Stati del professionista</text>
    
    <rect x="0" y="55" width="80" height="30" class="state-box state-ente"/>
    <text x="90" y="75" class="legend-text">Stati gestiti dall'Ente</text>
    
    <rect x="350" y="15" width="80" height="30" class="state-box state-final-ok"/>
    <text x="440" y="35" class="legend-text">Esito positivo</text>
    
    <rect x="350" y="55" width="80" height="30" class="state-box state-final-ko"/>
    <text x="440" y="75" class="legend-text">Esito negativo / Archiviazione</text>
    
    <polygon points="0,110 40,130 0,150 -40,130" class="decision"/>
    <text x="50" y="135" class="legend-text">Punto decisionale</text>
    
    <line x1="350" y1="120" x2="410" y2="120" class="arrow-special"/>
    <text x="420" y="125" class="legend-text">Percorso di ritorno</text>
  </g>
  
  <!-- Note -->
  <text x="450" y="1050" class="state-text-small" style="text-anchor: middle;">
    Nota: Stati specifici regionali (es. SPRESALWEB) e stati deprecati (Rifiutata, Verificata) non sono mostrati
  </text>
</svg>